<div class="container">
  <div class="header clearfix">
    <nav>
      <ul class="nav nav-pills pull-right">
        <li role="presentation" class="active"><a href="#">Home</a></li>
        <li role="presentation"><a href="#">About</a></li>
        <li role="presentation"><a href="#">Contact</a></li>
      </ul>
    </nav>
  </div>

  <div class="jumbotron">
    <h2>Giant Electric Impact</h2>
    <div id="googleMap" style="width:900px;height:380px;"></div>
    <% unless @result %>
      <p class="lead">Wonder how close you really are?  Enter your address below and click "Enter"</p>
    <% else %>
      <p class="lead">Your location approximately <%= @power_line_distance %> feet from the proposed 270 Kilovolt Power Lines</p>
    <% end %>
    <div class="row">
      <div class="col-lg-10">
      <form action="/" method="GET">
        <div class="input-group">
            <span class="input-group-btn">
              <button class="btn btn-default" type="submit">Estimate Distance:</button>
            </span>
            <input type="text" name="address" class="form-control" placeholder="My Address..." value="<%= @result ? @result.address : '' %>">
            <% if @result %>
            <span class="input-group-btn">
              <button class="btn btn-default clip-btn" type="button" data-clipboard-text="<%= @full_url %>">
                  Copy Link to Share
              </button>
            </span>
            <% end %>
        </div><!-- /input-group -->
      </div><!-- /.col-lg-6 -->
    </form>
    </div><!-- /.row -->
  </div>

  <div class="row marketing">
    <div class="col-lg-6">
      <h4>River Plaza Elementary School</h4>
      <p>Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.</p>

      <h4>Middletown Village Elementary School</h4>
      <p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet fermentum.</p>

      <h4>Subheading</h4>
      <p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
    </div>

    <div class="col-lg-6">
      <h4>Subheading</h4>
      <p>Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.</p>

      <h4>Subheading</h4>
      <p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet fermentum.</p>

      <h4>Subheading</h4>
      <p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
    </div>
  </div>

  <footer class="footer">
    <p>&copy; 2015 Company, Inc.</p>
  </footer>

</div> <!-- /container -->
<script>
function initialize() {
  var mapProp = {
    center:new google.maps.LatLng(40.38915,-74.11643),
    zoom:12,
    mapTypeId:google.maps.MapTypeId.HYBRID
  };
  var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);
  <%= raw(@power_line.to_placemark)%>
  <% @schools_data.each do |school_data| %>
      <% school = school_data[0] %>
      <% school_line_string = school_data[1][0] %>
      <% school_distance = school_data[1][1] %>
      var schoolMarker<%= school.id %> = new google.maps.Marker({
          position: new google.maps.LatLng( <%= school.location.latitude%>,<%=school.location.longitude %>),
          map: map,
          title: '<%= school.name %>',
          icon: 'electric.png'
      });
        <% !school.access.to_s.empty? ? school_link = "<a href=#{school.access} target=_BLANK>#{school.name}</a>" : school_link = "#{school.name}"%>
        var contentString<%= school.id %> = '<div id="content"><h4><%= raw(school_link) %></h4><h5><%= school_distance%> feet from proposed 270 Kilovolt Power Lines</h5></div>';
        var infowindow<%= school.id %> = new google.maps.InfoWindow({
                  content: contentString<%= school.id %>
        });
      google.maps.event.addListener(schoolMarker<%= school.id %>, 'click', function() {
                infowindow<%= school.id %>.open(map,schoolMarker<%= school.id %>);
      });
      <%= raw(school_line_string) %>
  <% end %>
  <% @power_parcels.each do |parcel|%>
      <%= raw(parcel.to_placemark) %>
  <% end %>
  <% if @result %>
    var marker = new google.maps.Marker({
            position: new google.maps.LatLng( <%= @result.latitude%>,<%=@result.longitude %>),
            map: map,
            title: '<%= @result.address %>'
        });
    var contentString = '<div id="content"><h4><%= @result.address %></h4></div>';
      var infowindow = new google.maps.InfoWindow({
                content: contentString
      });
    <%= raw(@power_line_string) %>
    google.maps.event.addListener(marker, 'click', function() {
              infowindow.open(map,marker);
    });
    var clipboard = new Clipboard('.clip-btn');

    clipboard.on('success', function(e) {
    	console.log(e);
    });

    clipboard.on('error', function(e) {
        console.log(e);
    });
  <% end %>
}
google.maps.event.addDomListener(window, 'load', initialize);

</script>
